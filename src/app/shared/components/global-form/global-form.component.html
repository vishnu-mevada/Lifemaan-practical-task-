<form [formGroup]="form" (ngSubmit)="onSubmit()">
    <div *ngFor="let field of fields" class="mat-form-field-wrapper">
        <mat-form-field appearance="fill" style="width: 100%;">
            <mat-label>{{ field.name }}</mat-label>

            <input matInput [type]="field.type || 'text'" [formControlName]="field.name"
                [readonly]="field.readonly || false" [id]="field.name" [attr.aria-label]="field.name" />

            <mat-error *ngIf="form.get(field.name)?.hasError('required') && form.get(field.name)?.touched">
                {{ field.name }} is required
            </mat-error>

            <mat-error *ngIf="form.get(field.name)?.hasError('email') && form.get(field.name)?.touched">
                Please enter a valid email address
            </mat-error>
        </mat-form-field>
    </div>

    <button mat-raised-button color="primary" type="submit">
        Submit
    </button>
</form>